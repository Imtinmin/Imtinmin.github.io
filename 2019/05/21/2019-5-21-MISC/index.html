<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> tshark 使用小结 · Imtinmin的小站</title><meta name="description" content="tshark 使用小结 - Imtinmin"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico?v=2018"><link rel="stylesheet" href="/css/style.css"><link rel="search" type="application/opensearchdescription+xml" href="http://imtinmin.github.io/atom.xml" title="Imtinmin的小站"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="wrap"><header><h1 class="title">Imtinmin的小站</h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about" target="_self">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">tshark 使用小结</h1><div class="post-info">2019-05-21</div><div class="post-content"><blockquote>
<p>文章首发于先知：<a href="https://xz.aliyun.com/t/4527" target="_blank" rel="noopener">https://xz.aliyun.com/t/4527</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">做misc类题，巧妙运用tshark提取数据包数据提取时可以节约大量的时间，最近做到misc类题目，正好学习记录一下</span><br></pre></td></tr></table></figure>
<p>官方文档：<a href="https://www.wireshark.org/docs/man-pages/tshark.html" target="_blank" rel="noopener">https://www.wireshark.org/docs/man-pages/tshark.html</a></p>
<h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-r 提取如wireshark表格中显示的封包摘要信息</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/1.png" alt="-r"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Y 使用filter过滤器</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/2.png" alt="-Y"></p>
<p>注意：需要加引号否则&amp;&amp;后面语句没用</p>
<p><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/3.png" alt="-Y"></p>
<p><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/4.png" alt="-Y"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-T 指出解析时输出的格式 </span><br><span class="line">     默认text </span><br><span class="line">     fields (需要增加-e参数)</span><br><span class="line">	 其他选项 ek|json|jsonraw|pdml|ps|psml|tabs</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-e 指定一个字段</span><br></pre></td></tr></table></figure>
<p>字段名可以在wireshark表达式里面找,例如usb包的<code>Leftover Capture Data</code>字段<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/8.png" alt="-e"><br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/9.png" alt="-e"><br>那么就可以用<code>usb capdata</code>提取这个字段<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/7.png" alt="-e"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark …… &gt;1.txt</span><br></pre></td></tr></table></figure>
<p>将提取结果重定向输出到文本文件里</p>
<h2 id="提取练习："><a href="#提取练习：" class="headerlink" title="提取练习："></a>提取练习：</h2><p><code>2018 红帽杯 Not only Wireshark</code></p>
<blockquote>
<p>链接：<a href="https://pan.baidu.com/s/1qI1wnVrfdIbpEXvwV0AmAg" target="_blank" rel="noopener">https://pan.baidu.com/s/1qI1wnVrfdIbpEXvwV0AmAg</a><br>提取码：yh5n </p>
</blockquote>
<p>过滤http流，发现name参数后面的参数有端倪<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/5.png" alt="http"><br>利用tshark提取，配合linux的命令<br>字段名为http.request.uri<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/6.png" alt="http"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark -r Not\ Only\ Wireshark -Y http -T fields -e http.request.uri</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/10.png" alt="http"><br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/11.png" alt="http"><br>发现有我们需要的url，但是也有不需要的，这时候需要用linux的grep命令进行过滤<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/12.png" alt="http"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark -r Not\ Only\ Wireshark -Y http -T fields -e http.request.uri | grep <span class="string">"/sqli/example2.php?name="</span></span><br></pre></td></tr></table></figure>
<p>再用<code>awk</code>命令提取<code>name=</code>后面的值，再用<code>tr</code>删掉换行符，使得输出成一行</p>
<p><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/13.png" alt="http"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark -r Not\ Only\ Wireshark.pcapng -Y http -T fields -e http.request.uri | grep <span class="string">"/sqli/example2.php?name="</span>| awk -F <span class="string">'='</span> <span class="string">'&#123;print $2&#125;'</span>|tr -d <span class="string">"\n"</span></span><br></pre></td></tr></table></figure>
<p><code>2017厦门邀请赛 traffic</code></p>
<blockquote>
<p>链接：<a href="https://pan.baidu.com/s/1s_zcwzUM_86mpVTT75PRpw" target="_blank" rel="noopener">https://pan.baidu.com/s/1s_zcwzUM_86mpVTT75PRpw</a><br>提取码：6jul </p>
</blockquote>
<p>比较难以捉摸,直接说步骤,要先发现开始icmp包中大量充斥的a字符串及heiheiehei!的提示<br> <img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/14.png" alt="icmp"><br>然后提取icmp data字段的长度值<br> <img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/15.png" alt="icmp"><br>字段名查询到是<code>Frame.len</code><br> <img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/16.png" alt="icmp"><br>提取命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark -r 2.pcapng -Y &quot;icmp &quot;-T fields -e frame.len | tr &quot;\n&quot; &quot;,&quot;</span><br></pre></td></tr></table></figure>
<p> <img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/tshark/17.png" alt="icmp"></p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2019/08/08/2019-8-8-CTF/">PREV</a><a class="next" href="/2019/05/04/2019-5-4-CTF-md/">NEXT</a></div><div class="copyright"><p>© 2019 PEACE & LOVE</p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>, <a href="https://github.com/jeremyfan/hexo-theme-still" target="_blank">theme</a> by <a href="https://github.com/jeremyfan" target="_blank">Imtinmin</a>.</p></div></footer></div></body></html>